---
import Layout from '../layouts/Layout.astro';
import Heading from '../components/atoms/Heading.astro';
import Text from '../components/atoms/Text.astro';
import ProjectCard from '../components/molecules/ProjectCard.astro';
import { getAllProjects, getProjectStats } from '../utils/projects';

// Obtener todos los proyectos y estadísticas desde Content Collections
const allProjects = await getAllProjects();
const projectStats = await getProjectStats();

// Categorías para filtros
const projectCategories = ["Todos", "Web Apps", "Infrastructure Projects", "Security Tools"];
---

<Layout title="Proyectos | Carlos Mairena" currentPath="/proyectos">
	<!-- Hero Section -->
	<section class="bg-gradient-to-br from-blue-50 to-purple-50 py-16">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center">
				<Heading level={1} class="mb-6">
					Mis <span class="bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Proyectos</span>
				</Heading>
				<Text color="secondary" size="xl" class="max-w-3xl mx-auto">
					Una selección de proyectos que muestran mi experiencia en desarrollo web, infraestructura y ciberseguridad
				</Text>
			</div>
		</div>
	</section>
	
	<!-- Filter Section -->
	<section class="py-8 bg-white border-b border-gray-200">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center">
				<Text color="secondary" class="mb-4">Filtrar por categoría:</Text>
				<div class="flex flex-wrap justify-center gap-3">
					{projectCategories.map(category => (
						<button 
							class="filter-btn px-4 py-2 rounded-full border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
							data-category={category}
						>
							{category}
						</button>
					))}
				</div>
			</div>
		</div>
	</section>
	
	<!-- Projects Grid -->
	<main class="py-16 bg-gray-50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<!-- Stats Section -->
			<div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
				<div class="text-center p-6 bg-white rounded-lg shadow-sm">
					<div class="text-3xl font-bold text-blue-600 mb-2">{projectStats.total}</div>
					<Text color="secondary" size="sm">Proyectos Totales</Text>
				</div>
				<div class="text-center p-6 bg-white rounded-lg shadow-sm">
					<div class="text-3xl font-bold text-green-600 mb-2">{projectStats.webApps}</div>
					<Text color="secondary" size="sm">Aplicaciones Web</Text>
				</div>
				<div class="text-center p-6 bg-white rounded-lg shadow-sm">
					<div class="text-3xl font-bold text-yellow-600 mb-2">{projectStats.infrastructure}</div>
					<Text color="secondary" size="sm">Infraestructura</Text>
				</div>
				<div class="text-center p-6 bg-white rounded-lg shadow-sm">
					<div class="text-3xl font-bold text-red-600 mb-2">{projectStats.security}</div>
					<Text color="secondary" size="sm">Seguridad</Text>
				</div>
			</div>
			
			<!-- Projects Grid -->
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="projects-grid">
				{allProjects.map(project => (
					<div class="project-item" data-category={project.projectCategory}>
						<ProjectCard
							title={project.title}
							description={project.description}
							image={project.image}
							technologies={project.technologies}
							githubUrl={project.githubUrl}
							demoUrl={project.demoUrl}
							category={project.category as 'primary' | 'warning' | 'danger'}
							projectCategory={project.projectCategory}
						/>
					</div>
				))}
			</div>
		</div>
	</main>
	
	<!-- CTA Section -->
	<section class="py-16 bg-blue-500">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<Heading level={2} size="2xl" class="mb-6 text-white">
				¿Tienes un proyecto en mente?
			</Heading>
			<Text size="lg" class="text-white mb-8 max-w-2xl mx-auto">
				Me encanta trabajar en proyectos desafiantes. Si tienes una idea o necesitas ayuda 
				con desarrollo, infraestructura o seguridad, hablemos.
			</Text>
			<div class="flex flex-col sm:flex-row gap-4 justify-center">
				<a href="/contacto" class="inline-flex items-center justify-center px-6 py-3 bg-white text-blue-600 font-medium rounded-lg hover:bg-gray-100 transition-colors duration-200">
					Iniciar Conversación
				</a>
				<a href="/sobre-mi" class="inline-flex items-center justify-center px-6 py-3 border border-blue-200 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">
					Conocer Más Sobre Mí
				</a>
			</div>
		</div>
	</section>
</Layout>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const filterButtons = document.querySelectorAll('.filter-btn');
		const projectItems = document.querySelectorAll('.project-item');
		
		// Set initial active state
		filterButtons[0].classList.add('bg-blue-600', 'text-white');
		filterButtons[0].classList.remove('border-gray-300', 'text-gray-700');
		
		filterButtons.forEach(button => {
			button.addEventListener('click', () => {
				const category = button.getAttribute('data-category');
				
				// Update button states
				filterButtons.forEach(btn => {
					btn.classList.remove('bg-blue-600', 'text-white');
					btn.classList.add('border-gray-300', 'text-gray-700');
				});
				button.classList.add('bg-blue-600', 'text-white');
				button.classList.remove('border-gray-300', 'text-gray-700');
				
				// Filter projects
				projectItems.forEach(item => {
					const itemCategory = item.getAttribute('data-category');
					if (category === 'Todos' || itemCategory === category) {
						(item as HTMLElement).style.display = 'block';
					} else {
						(item as HTMLElement).style.display = 'none';
					}
				});
			});
		});
	});
</script>
