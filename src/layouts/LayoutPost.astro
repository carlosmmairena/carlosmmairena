---
import Footer from '../components/organisms/Footer.astro';
import Header from '../components/organisms/Header.astro';
import Badge from '../components/atoms/Badge.astro';
import Button from '../components/atoms/Button.astro';
import Icon from '../components/atoms/Icon.astro';
import Text from '../components/atoms/Text.astro';

import "../styles/global.css";
import RemoteImage from '../components/atoms/RemoteImage.astro';

const { frontmatter, url } = Astro.props;

const formattedDate = frontmatter.pubDate.toLocaleDateString('es-ES', {
	year: 'numeric',
	month: 'long',
	day: 'numeric'
});
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={frontmatter.description} />
		<meta name="keywords" content="programación, ciberseguridad, monitoreo, hardening, tutoriales, carlos mairena, costa rica, guanacaste">
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content="v1.0" />
		<title>{frontmatter.title}</title>
	</head>
	
	<Header currentPath={url} />

	<body class="font-sans bg-white text-gray-900">
		<!-- Hero Section con imagen de fondo -->
		<div class="relative bg-gradient-to-br from-blue-50 to-purple-50 py-12">
			<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
				<!-- Breadcrumb -->
				<div class="mb-6">
					<Button variant="outline" size="sm" href="/blog">
						<Icon name="arrow-left" size="sm" class="mr-2" />
						Volver al blog
					</Button>
				</div>

				<!-- Tags -->
				{frontmatter.tags && frontmatter.tags.length > 0 && (
					<div class="flex flex-wrap gap-2 mb-4">
						{frontmatter.tags.map((tag: string) => (
							<Badge variant="primary">
								<a href={`/tags/${tag}/`} class="hover:underline">
									#{tag}
								</a>
							</Badge>
						))}
					</div>
				)}

				<!-- Title -->
				<h1 class="text-4xl md:text-5xl font-bold text-gray-900 leading-tight mb-6">
					{frontmatter.title}
				</h1>

				<!-- Description -->
				<p class="text-xl text-gray-700 mb-6 leading-relaxed">
					{frontmatter.description}
				</p>

				<!-- Metadata -->
				<div class="flex flex-wrap items-center gap-4 text-gray-600">
					<div class="flex items-center gap-2">
						<Icon name="user" size="sm" />
						<span class="font-medium">{frontmatter.author}</span>
					</div>
					<span class="text-gray-400">•</span>
					<div class="flex items-center gap-2">
						<Icon name="calendar" size="sm" />
						<time datetime={frontmatter.pubDate.toISOString()}>
							{formattedDate}
						</time>
					</div>
				</div>
			</div>
		</div>

		<!-- Featured Image -->
		{frontmatter.image && frontmatter.image.url && (
			<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 -mt-8 mb-12">
				<div class="rounded-xl overflow-hidden shadow-xl">
					<RemoteImage 
						src={frontmatter.image.url} 
						alt={frontmatter.image.alt || frontmatter.title}
						class="w-5xl h-auto object-cover"
					/>
				</div>
			</div>
		)}

		<!-- Article Content -->
		<article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
			<div class="prose prose-lg prose-gray max-w-none
				prose-headings:font-bold prose-headings:text-gray-900
				prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6
				prose-h3:text-2xl prose-h3:mt-8 prose-h3:mb-4
				prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-6
				prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
				prose-strong:text-gray-900 prose-strong:font-semibold
				prose-code:text-purple-600 prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
				prose-pre:bg-gray-900 prose-pre:text-gray-100
				prose-img:rounded-lg prose-img:shadow-md
				prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:pl-4 prose-blockquote:italic
				prose-ul:list-disc prose-ul:ml-6
				prose-ol:list-decimal prose-ol:ml-6
				prose-li:text-gray-700 prose-li:mb-2">
				<slot />
			</div>
		</article>

		<!-- Share & Navigation -->
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 border-t border-gray-200">
			<div class="flex flex-col md:flex-row justify-between items-center gap-4">
				<div class="flex items-center gap-3">
					<Text color="secondary" weight="medium">
						¿Te gustó este artículo?
					</Text>
					<Button variant="primary" size="sm" href="/blog">
						Ver más artículos
					</Button>
				</div>
				{frontmatter.tags && frontmatter.tags.length > 0 && (
					<div class="flex items-center gap-2">
						<Text color="muted" size="sm">
							Relacionados:
						</Text>
						{frontmatter.tags.slice(0, 3).map((tag: string) => (
							<Badge variant="secondary" size="sm">
								<a href={`/tags/${tag}/`} class="hover:underline">
									#{tag}
								</a>
							</Badge>
						))}
					</div>
				)}
			</div>
		</div>
	</body>

	<Footer />
</html>

<style is:global>
	/* Mejoras adicionales para el contenido del artículo */
	article img {
		margin: 2rem auto;
	}
	
	article pre {
		padding: 1.5rem;
		overflow-x: auto;
		border-radius: 0.5rem;
	}
	
	article code {
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
		font-size: 0.875em;
	}
</style>
